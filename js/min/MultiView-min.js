var MultiView={crimeData:null,crime:null,all:null,date:null,dates:null,hour:null,hours:null,charts:null,getDate:function(t){var e=d3.time.format("%Y-%m-%dT%H:%M:%S").parse;return e(t.event_clearance_date)},init:function(t,e,r){function n(t){d3.select(this).call(t)}function a(){w.each(n),d3.select("#active").text(s(f.value()))}function l(t){return new Date(2001,t.substring(0,2)-1,t.substring(2,4),t.substring(4,6),t.substring(6,8))}function i(){function t(t){function i(t){for(var e=[],a=-1,l=t.length,i;++a<l;)i=t[a],e.push("M",r(i.key),",",h,"V",n(i.value),"h9V",h);return e.join("")}function o(t){var e=+("e"==t),r=e?1:-1,n=h/3;return"M"+.5*r+","+n+"A6,6 0 0 "+e+" "+6.5*r+","+(n+6)+"V"+(2*n-6)+"A6,6 0 0 "+e+" "+.5*r+","+2*n+"ZM"+2.5*r+","+(n+8)+"V"+(2*n-8)+"M"+4.5*r+","+(n+8)+"V"+(2*n-8)}var d=r.range()[1],h=n.range()[0];n.domain([0,c.top(1)[0].value]),t.each(function(){var t=d3.select(this),n=t.select("g");if(n.empty()){t.select(".title").append("a").attr("href","javascript:reset("+a+")").attr("class","reset").text("reset").style("display","none"),n=t.append("svg").attr("width",d+e.left+e.right).attr("height",h+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),n.append("clipPath").attr("id","clip-"+a).append("rect").attr("width",d).attr("height",h),n.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(t){return t+" bar"}).datum(c.all()),n.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+a+")"),n.append("g").attr("class","axis").attr("transform","translate(0,"+h+")").call(l);var f=n.append("g").attr("class","brush").call(s);f.selectAll("rect").attr("height",h),f.selectAll(".resize").append("path").attr("d",o)}if(u)if(u=!1,n.selectAll(".brush").call(s),t.select(".title a").style("display",s.empty()?"none":null),s.empty())n.selectAll("#clip-"+a+" rect").attr("x",0).attr("width",d);else{var p=s.extent();n.selectAll("#clip-"+a+" rect").attr("x",r(p[0])).attr("width",r(p[1])-r(p[0]))}n.selectAll(".bar").attr("d",i)})}i.id||(i.id=0);var e={top:10,right:10,bottom:20,left:10},r,n=d3.scale.linear().range([100,0]),a=i.id++,l=d3.svg.axis().orient("bottom"),s=d3.svg.brush(),u,o,c,d;return s.on("brushstart.chart",function(){var t=d3.select(this.parentNode.parentNode.parentNode);t.select(".title a").style("display",null)}),s.on("brush.chart",function(){var t=d3.select(this.parentNode),e=s.extent();d&&t.select(".brush").call(s.extent(e=e.map(d))).selectAll(".resize").style("display",null),t.select("#clip-"+a+" rect").attr("x",r(e[0])).attr("width",r(e[1])-r(e[0])),o.filterRange(e)}),s.on("brushend.chart",function(){if(s.empty()){var t=d3.select(this.parentNode.parentNode.parentNode);t.select(".title a").style("display","none"),t.select("#clip-"+a+" rect").attr("x",null).attr("width","100%"),o.filterAll()}}),t.margin=function(r){return arguments.length?(e=r,t):e},t.x=function(e){return arguments.length?(r=e,l.scale(r),s.x(r),t):r},t.y=function(e){return arguments.length?(n=e,t):n},t.dimension=function(e){return arguments.length?(o=e,t):o},t.filter=function(e){return e?(s.extent(e),o.filterRange(e)):(s.clear(),o.filterAll()),u=!0,t},t.group=function(e){return arguments.length?(c=e,t):c},t.round=function(e){return arguments.length?(d=e,t):d},d3.rebind(t,s,"on")}var s=d3.format(",d"),u=d3.format("+,d"),o=d3.time.format("%B %d, %Y"),c=d3.time.format("%I:%M %p"),d=d3.nest().key(function(t){return d3.time.day(t.date)}),h=crossfilter(t),f=h.groupAll(),p=h.dimension(function(t){return MultiView.getDate(t)});dates=p.group(d3.time.day),hour=h.dimension(function(t){return MultiView.getDate(t).getHours()+MultiView.getDate(t).getMinutes()/60}),hours=hour.group(Math.floor),this.crime=h,this.all=f,this.date=p,this.dates=dates,this.hour=hour,this.hours=hours;var g=d3.max(Model.crimeData,function(t){return MultiView.getDate(t)}),m=d3.min(Model.crimeData,function(t){return MultiView.getDate(t)}),v=new Date(g.setDate(g.getDate()+2)),b=new Date(m.setDate(m.getDate()-2)),y=[i().dimension(hour).group(hours).x(d3.scale.linear().domain([0,24]).rangeRound([0,240])),i().dimension(p).group(dates).round(d3.time.day.round).x(d3.time.scale().domain([b,v]).rangeRound([0,900])).filter([e,g])];this.charts=y;var w=d3.selectAll(".chart").data(y).each(function(t){t.on("brush",a).on("brushend",a)});d3.selectAll("#total").text(s(h.size())),a(),window.filter=function(t){t.forEach(function(t,e){y[e].filter(t)}),a()},window.reset=function(t){y[t].filter(null),a()}}};